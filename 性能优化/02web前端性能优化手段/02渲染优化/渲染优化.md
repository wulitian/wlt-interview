# 渲染优化

#### 渲染过程

渲染过程的5步：js处理=>计算样式=>页面布局=>绘制=>合成

1. 处理html标记并构建dom树
2. 处理css标记并构建cssom树
3. dom树与cssom树合成render树
4. 根据render树计算布局，与几何信息
5. 将各个节点绘制到屏幕上

## html文件优化

除空格换行字符尽量保持精简去掉无用的注释，缩小尺寸（minify）压缩资源（gzip）使用http缓存（http cache）

## css文件优化

除空格换行字符尽量保持精简去掉无用的注释，缩小尺寸（minify）压缩资源（gzip）使用http缓存（http cache）

- 将脚本放在页面head最前面

- 声明阻塞式渲染

- 声明打印网页时应用

- 声明媒体查询时应用

- 避免css文件中使用@import

## js文件优化

- 除空格换行字符尽量保持精简去掉无用的注释，缩小尺寸（minify）压缩资源（gzip）使用http缓存（http cache）

- 将脚本放在页面末尾

- 使用异步延迟加载

## 布局优化

触发浏览器布局与重绘的操作：1.DOM 元素几何属性的修改，这些属性包括
width,height,padding，margin,left,top 2.更改dom树结构 3. 获取特定的属性值操作offsetHeight,offsetWidth
,offsetTop,offsetLeft,scrollTop,scrollWidth等

- 避免对样式频繁修改

- 使用类对样式逐条修改

- 缓存对敏感样式属性值的计算

- 使用requestAnimationFrame方法控制渲染帧

- 降低绘制复杂度

## 样式计算优化

- 降低选择器复杂度（css引擎是从右到做寻找）

- 尽量不使用通配符*

- 使用BEM规范

建议所有的元素都被单一的类修饰，BEM 是一种 CSS 的书写规范，它的名称是由三个单词的首字母组成的，分别是块（Block）、元素（Element）和修饰符（Modifier）。理论上它希望每行 CSS 代码只有一个选择器，这就是为了降低选择器的复杂性，对选择器的命名要求通过以下三个符号的组合来实现。

中画线（-）：仅作为连字符使用，表示某个块或子元素的多个单词之间的连接符。
单下画线（_）：作为描述一个块或其子元素的一种状态。
双下画线（__）：作为连接块与块的子元素。s

## js执行优化

- 动画实现

- 合理使用防抖节流

- 使用web worker

## 合成处理

- 在降低绘制复杂度小节中讲到，可通过将固定区域和动画区域拆分到不同图层上进行绘制，来达到绘制区域最小化的目的。接下来我们就来探讨如何创建新的图层，最佳方式便是使用 CSS 属性 will-change

- 通过opacity与transform生成新的图层，可以是元素单独绘制。

