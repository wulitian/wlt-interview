## 事件循环

宏任务
|  任务                     | 浏览器  |  node   | 描述                 |
|  ----------------------  | ----   |  ----   | ---------------      |
| setTimeout               | 是     |  是      | 在指定的毫秒数后调用函数 |
| setInterval              | 是     |  是      | 定时调用函数           |
| script标签                | 是     |  否      | 整体代码块             |
| I/O请求                   | 是     |  是      | 例如文件请求，网络请求等  |
| DOM事件                   | 是     |  否      | 例如点击事件，hover事件等 |   
| requestAnimationFrame    | 是     |  否      | 浏览器重绘前更新动画      |
| postMessage              | 是     |  否      | iframe跨域通信          |
| MessageChannel           | 是     |  是      | 管道通信                |
| setImmediate             | 否     |  是      | 一次事件循环执行完毕调用   |
微任务
|  任务                         | 浏览器  |  node   | 描述                 |
|  ----------------------      | ----   |  ----   | ---------------      |
| Promise中resolve和reject回调   | 是     |  是      | 回调                 |
| async函数中的await异步函数      | 是     |  是      | 回调                  |
| MutationObserver             | 是     |  否      | 监听DOM变动触发         |
| process.nextTick             | 否     |  是      | 当前任务结束后执行       |

#### 浏览器事件循环
1. 解析HTML中遇到script标签，开始执行第一个宏任务。
2. 在宏任务执行中遇到宏任务，执行其中的请求（例如网络请求，定时器），在请求完成后将回调放入宏任务队列中。
3. 在宏任务执行中遇到微任务，暂不执行回调，而是放入微任务队列中。
4. 宏任务执行完成。开始依次执行微任务队列中的任务。
6. 微任务执行中遇到宏任务或者微任务，处理方式同上，分别放入各自的队列中。
7. 微任务队列清空后，开始执行宏任务队列中的下一个任务。
#### node中的事件循环
一. node中的宏任务队列
Node.js的宏任务队列并不是一整个队列，而是根据事件类型做出了区分，分为了六个队列，
依次执行： 
1. timers 定时器队列，执行定时器的回调 
2. pending callbacks 挂起的回调函数，用于某些系统回调 
3. idle, prepare 仅在内部使用 
4. poll 执行I/O事件回调 
5. check setImmediate回调 
6. close callbacks close事件的回调，例如 socket.on('close', ...)
二、执行流程
1. 首先执行主线代码，遇到宏任务就分配到对应的宏任务队列中，微任务也划分到主线的微任务队列中，直到执行完毕。
2. 执行主线代码的微任务队列中的所有任务。
3. 没有宏任务则执行结束，有则开始事件循环。在事件循环中，按照上述的6个宏任务队列依次执行。下面的步骤是单个队列中的流程。
4. 在单个宏任务队列中，选择一个宏任务执行。如果执行中遇到新的宏任务就分配到对应的宏任务队列中。遇到微任务就放到该宏任务的微任务队列中。
5. 一个宏任务执行完毕后，执行process.nextTick中的回调（如果有）。
6. 执行当前宏任务的微任务队列中的任务，直到微任务队列清空。
7. 在上面的单个宏任务队列中，再选择一个宏任务执行。直到当前宏任务队列清空或者到达上限。
8. 选择下一个宏任务队列执行。
9. 6个宏任务队列都执行完毕，才叫做一次事件循环执行完毕。
